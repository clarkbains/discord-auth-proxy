Request -> Traeffik -> auth proxy
Checks for a X-CWDC-Token header, param, or cookie, 
No -> Record in rec caach, redirect user to oauth with id as data
Yes -> Get Scopes for user. Find in Catalog Cache what scopes are required. Pick appropriately. Set 

Checks for a domain match in the catalog cache


OAUTH Redirect -> Get Access token, get user id, bot prefetch permission. Redirect User towards initial domain, add reqId as query Parameter.




check cache for permissions with id
If yes, return true


ReqCache
(id, original URL)


Permission Cache
(reqId, discord user, scopes, created)



Catalog Cache
(domainRegex, scopes[])
